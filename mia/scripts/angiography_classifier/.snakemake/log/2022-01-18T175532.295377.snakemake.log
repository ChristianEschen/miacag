Building DAG of jobs...
Using shell: /bin/bash
Provided cores: 2
Rules claiming more threads will be scaled down.
Job stats:
job                   count    min threads    max threads
------------------  -------  -------------  -------------
all                       1              1              1
copy_config               1              1              1
copy_table                1              1              1
eval_model_val_set        1              1              1
plot_results_test         1              1              1
plot_results_train        1              1              1
plot_results_val          1              1              1
split_train_val           1              1              1
train_model               1              1              1
total                     9              1              1


[Tue Jan 18 17:55:32 2022]
rule copy_table:
    input: /home/gandalf/angiography_data/runs/Jan18_17-55-32_gandalf-MS-7845test
    output: runs/506af35f-1f59-4ae9-91d8-3eeba1bcf5f6.log
    jobid: 1
    resources: tmpdir=/tmp


[Tue Jan 18 17:55:32 2022]
rule copy_config:
    input: ../../configs/classification/_3D/classification_config_angio.yaml
    output: runs/77154cb4-442b-4dcb-b32e-8f53baf8980d.yaml
    jobid: 2
    resources: tmpdir=/tmp

[Tue Jan 18 17:55:32 2022]
Finished job 2.
1 of 9 steps (11%) done
[Tue Jan 18 17:55:32 2022]
Finished job 1.
2 of 9 steps (22%) done

[Tue Jan 18 17:55:32 2022]
rule split_train_val:
    input: runs/77154cb4-442b-4dcb-b32e-8f53baf8980d.yaml, /home/gandalf/angiography_data/runs/Jan18_17-55-32_gandalf-MS-7845test, runs/506af35f-1f59-4ae9-91d8-3eeba1bcf5f6.log
    output: runs/79e90b54-0d4e-4748-b26d-e9bc51c2306c.log
    jobid: 4
    resources: tmpdir=/tmp

[Tue Jan 18 17:55:33 2022]
Finished job 4.
3 of 9 steps (33%) done

[Tue Jan 18 17:55:33 2022]
rule train_model:
    input: /home/gandalf/mia/data/angio, runs/77154cb4-442b-4dcb-b32e-8f53baf8980d.yaml, /home/gandalf/angiography_data/runs/Jan18_17-55-32_gandalf-MS-7845test, runs/506af35f-1f59-4ae9-91d8-3eeba1bcf5f6.log, runs/79e90b54-0d4e-4748-b26d-e9bc51c2306c.log
    output: /home/gandalf/angiography_data/runs/Jan18_17-55-32_gandalf-MS-7845test/model.pt
    jobid: 3
    resources: tmpdir=/tmp

[Tue Jan 18 17:55:35 2022]
Error in rule train_model:
    jobid: 3
    output: /home/gandalf/angiography_data/runs/Jan18_17-55-32_gandalf-MS-7845test/model.pt
    shell:
        
       NCCL_DEBUG=info \
       python -m torch.distributed.launch \
       --nproc_per_node 1 \
       --nnodes 1 \
       --node_rank 0 \
       --master_addr 127.0.1.1 \
       --master_port 1232 \
       ../../trainer.py \
       --config runs/77154cb4-442b-4dcb-b32e-8f53baf8980d.yaml \
       --DataSetPath /home/gandalf/mia/data/angio \
       --output_directory /home/gandalf/angiography_data/runs/Jan18_17-55-32_gandalf-MS-7845test \
       --database mydb \
       --username gandalf \
       --password 123qweasd \
       --host localhost \
       --table_name dicom_table_Jan18_17-55-32_gandalf-MS-7845test \
       --query "SELECT * FROM ?table_name WHERE phase IS DISTINCT FROM 'test';" \
       --cpu True \
       --num_workers 2
       
        (one of the commands exited with non-zero exit code; note that snakemake uses bash strict mode!)

Shutting down, this might take some time.
Exiting because a job execution failed. Look above for error message
Complete log: /home/gandalf/mia/scripts/angiography_classifier/.snakemake/log/2022-01-18T175532.295377.snakemake.log
